function tcart__init(recid){
	
	var el=$('.t706');
	
	/* prevent dubble init */
	if(typeof window.tcart_initted!='undefined' && window.tcart_initted=='yes'){
		if( el.length > 1 ){
			var str='<div style="color:red;">Error: Two cart widgets on the page</div>';
			$('.t706__previewmode-infobox center').append(str);
			/* console.log(str); */
			return;
		}
	}
	
	/* dont store */
	var fooo=el.attr('data-cart-dontstore');
	if(typeof fooo!='undefined' && fooo=='y'){
		window.tcart_dontstore='y';
	}

	var fooo=el.attr('data-cart-oneproduct');
	if(typeof fooo!='undefined' && fooo=='y'){
		window.tcart_oneproduct='y';
	}
	
	/* max days */
	var fooo=el.attr('data-cart-maxstoredays');	
	if(typeof fooo!='undefined' && fooo!='' && fooo>=0){
		window.tcart_maxstoredays=fooo;
	}

	//stat
	var fooo=el.attr('data-cart-sendevent-onadd');
	if(typeof fooo!='undefined' && fooo=='y'){
		window.tcart_sendevent_onadd='y';
	}
	
	window.tcart_initted='yes';
	
	tcart__drawBottomTotalAmount();		
	
	tcart__loadLocalObj();
	
	tcart__reDrawCartIcon();

	tcart__addEvent__links();
	setInterval( function(){ 
		tcart__addEvent__links();
	} , 5000);
	
	tcart__addEvents();
	
	tcart__addEvent__selectpayment();
	
	/* fix def visible */
	$('#rec'+recid).attr('data-animationappear','off');
	$('#rec'+recid).css('opacity','1');
	
    /* define user language */
    window.tildaBrowserLang = window.navigator.userLanguage || window.navigator.language;
    window.tildaBrowserLang = window.tildaBrowserLang.toUpperCase();
    if (window.tildaBrowserLang.indexOf('RU')!=-1){
        window.tildaBrowserLang = 'RU';
    }else if (window.tildaBrowserLang.indexOf('FR')!=-1){
        window.tildaBrowserLang = 'FR';
    }else if (window.tildaBrowserLang.indexOf('DE')!=-1){
        window.tildaBrowserLang = 'DE';
    }else if (window.tildaBrowserLang.indexOf('ES')!=-1){
        window.tildaBrowserLang = 'ES';
    }else if (window.tildaBrowserLang.indexOf('PT')!=-1){
        window.tildaBrowserLang = 'PT';
    }else if (window.tildaBrowserLang.indexOf('UA')!=-1){
        window.tildaBrowserLang = 'UA';
    }else if (window.tildaBrowserLang.indexOf('JA')!=-1){
        window.tildaBrowserLang = 'JA';
    }else if (window.tildaBrowserLang.indexOf('CN')!=-1){
        window.tildaBrowserLang = 'CN';
    } else {
        window.tildaBrowserLang = 'EN';
    }
    
    if(el.find('.t-input-group_dl').length){
	    $('.t706__cartwin-prodamount-label').html( tcart__dict(2,'Subtotal') + ':&nbsp;' );
	    $('.t706__cartwin-totalamount-label').html( tcart__dict(3,'Total') + ':&nbsp;' );
	}else{
	    $('.t706__cartwin-prodamount-label').html( tcart__dict(1,'Total') + ':&nbsp;' );
	    $('.t706__cartwin-totalamount-label').html( tcart__dict(1,'Total') + ':&nbsp;' );
	}
    
    /* add auto title for popup */
    if( $('.t706__cartwin-heading').html()==''){	    
	    $('.t706__cartwin-heading').html( tcart__dict(4,'Your order') + ':');
    }

	/* add auto title for submit form button */
    if( $('.t706 .t-form__submit .t-submit').html()=='Submit' ){
	    $('.t706 .t-form__submit .t-submit').html( tcart__dict(5,'Submit order') );
    }
	
	/* add auto title for payment method if exist */
	if( el.find('.t-input-group_pm').length ){
		el.find('.t-input-group_pm').find('.t-input-title').html( tcart__dict(6,'Payment method') );
	}
	
	
	/* cart icon hint on hover */
	/*
	$('.t706__carticon-text').html( tcart__dict(7,'Click to order') );
	*/
	
}

function tcart__dict(i){
	var d=[];
	
	var w={};
	w['EN']="Total";
	w['RU']="Сумма";
	w['FR']="Total";
	w['DE']="Gesamtsumme";
	w['ES']="Total";
	w['PT']="Total";
	w['UA']="Сума";
	w['JA']="合計";
	w['CN']="总额。";
	d[1]=w;

	var w={};
	w['EN']="Subtotal";
	w['RU']="Сумма";
	w['FR']="Sous-total";
	w['DE']="Zwischensumme";
	w['ES']="Subtotal";
	w['PT']="Subtotal";
	w['UA']="Сума";
	w['JA']="小計";
	w['CN']="小计。";	
	d[2]=w;

	var w={};
	w['EN']="Total";
	w['RU']="Итоговая сумма";
	w['FR']="Total";
	w['DE']="Gesamtsumme";
	w['ES']="Total";
	w['PT']="Total";
	w['UA']="Підсумкова сума";
	w['JA']="合計";
	w['CN']="总额。";	
	d[3]=w;

	var w={};
	w['EN']="Your order";
	w['RU']="Ваш заказ";
	w['FR']="Votre commande";
	w['DE']="Ihre Bestellung";
	w['ES']="Su pedido";
	w['PT']="Seu pedido";
	w['UA']="Ваше замовлення";
	w['JA']="注文済";
	w['CN']="你的订货。";	
	d[4]=w;

	var w={};
	w['EN']="Submit order";
	w['RU']="Оформить заказ";
	w['FR']="Commander";
	w['DE']="Bestellung abschicken";
	w['ES']="Enviar pedido";
	w['PT']="Enviar pedido";
	w['UA']="Оформити замовлення";
	w['JA']="注文を確定";
	w['CN']="办妥订货。";	
	d[5]=w;

	var w={};
	w['EN']="Payment method";
	w['RU']="Способ оплаты";
	w['FR']="Mode de paiement";
	w['DE']="Zahlungsmethode";
	w['ES']="Método de pago";
	w['PT']="Método de pagamento";
	w['UA']="Спосіб оплати";
	w['JA']="支払方法";
	w['CN']="付款方式。";	
	d[6]=w;

	var w={};
	w['EN']="Click to order	";
	w['RU']="Оформить заказать";
	w['FR']="Commander";
	w['DE']="Bestellung abschicken";
	w['ES']="Enviar pedido";
	w['PT']="Enviar pedido";
	w['UA']="Оформити замовлення";
	w['JA']="注文を確定";
	w['CN']="提交订单。";	
	d[7]=w;	

	var w={};
	w['EN']="Subtotal with discount";
	w['RU']="Сумма со скидкой";
	w['FR']="Sous-total avec remise";
	w['DE']="Zwischensumme mit Rabatt";
	w['ES']="Subtotal con descuento";
	w['PT']="Subtotal com desconto";
	w['UA']="Сума зі знижкою";
	w['JA']="割引後小計";
	w['CN']="减价同小计。";
	d[8]=w;	

	var w={};
	w['EN']="Promo code";
	w['RU']="Промокод";
	w['FR']="Code promo";
	w['DE']="Aktionscode";
	w['ES']="Código promocional";
	w['PT']="Código promocional";
	w['UA']="Промокод";
	w['JA']="プロモコード";
	w['CN']="促销代码。";
	d[9]=w;	

	var w={};
	w['EN']="Discount";
	w['RU']="Скидка";
	w['FR']="Remise";
	w['DE']="Rabatt";
	w['ES']="Descuento";
	w['PT']="Desconto";
	w['UA']="Знижка";
	w['JA']="割引";
	w['CN']="减价。";	
	d[10]=w;	

	var w={};
	w['EN']="Minimal order";
	w['RU']="Минимальный заказ";
	w['FR']="Commande minimale";
	w['DE']="Minimale Bestellung";
	w['ES']="Pedido mínimo";
	w['PT']="Pedido mínimo";
	w['UA']="Мінімальне замовлення";
	w['JA']="最小注文価格";
	w['CN']="最小的订货。";	
	d[11]=w;

	var w={};
	w['EN']="Minimal order quantity";
	w['RU']="Минимальное количество в заказе";
	w['FR']="Quantité de commande minimale";
	w['DE']="Mindestbestellmenge";
	w['ES']="Cantidad mínima del pedido";
	w['PT']="Quantidade mínima por pedido";
	w['UA']="Мінімальна кількість у замовленні";
	w['JA']="最小注文数";
	w['CN']="最小的总数。";	
	d[12]=w;	

	var w={};
	w['EN']="Sorry, limit has been reached. This is the maximum quantity of goods in stock";
	w['RU']="Извините, достигнут лимит. Это максимально возможное количество товаров в наличии";	
	d[13]=w;	

	var w={};
	w['EN']="free";
	w['RU']="бесплатно";	
	w['FR']="gratuit";
	w['DE']="kostenlos";
	w['ES']="gratis";
	w['PT']="livre";
	w['UA']="безкоштовно";
	w['JA']="無料で";
	w['CN']="免费";	
	d[14]=w;	
		
	var lang=window.tildaBrowserLang;
	if(typeof d[i]!=undefined){
		if(typeof d[i][lang]!='undefined' && typeof d[i][lang]!=''){
			return d[i][lang];
		}else{
			return d[i]['EN'];
		}
	}
}

function tcart__nullObj(){
	var tcart=new Object();
	tcart['products']=[];
	tcart['prodamount']=0;
	tcart['amount']=0;
	tcart['system']='';	
	return tcart;
}

function tcart__loadLocalObj(){
	
	var data_json_str = null;

	if (typeof localStorage === 'object') {
	    try {
			data_json_str = localStorage.getItem('tcart');		    
	    } catch (e) {
	        console.log('Your web browser does not support storing a Cart data locally.');
	    }
	}		
	
	if(data_json_str===null){
		window.tcart=tcart__nullObj();
	}else{
		window.tcart=JSON.parse(data_json_str);		
	}
	
	/* how old info */
	if(typeof window.tcart_maxstoredays!='undefined' && window.tcart_maxstoredays!=''){
		var foo=window.tcart_maxstoredays;
		if(foo>0){
			if(typeof window.tcart.updated!='undefined' && window.tcart.updated>0){
				var ts=Math.floor(Date.now() / 1000);
				var delta=(ts*1) - (window.tcart.updated*1);
				if( delta > 60*60*24*foo ){
					window.tcart=tcart__nullObj();
				}
			}
		}else if(foo=='0'){
			window.tcart=tcart__nullObj();
		}
	}else{
		if(typeof window.tcart.updated!='undefined' && window.tcart.updated>0){
			var ts=Math.floor(Date.now() / 1000);
			var delta=(ts*1) - (window.tcart.updated*1);
			if( delta > 60*60*24*30 ){
				window.tcart=tcart__nullObj();
			}
		}		
	}
	
	/* do not store */
	if(typeof window.tcart_dontstore!='undefined' && window.tcart_dontstore=='y'){
		window.tcart=tcart__nullObj();
	}	
	
	/* set currency sign */
	/* set default */
	delete window.tcart['currency'];
	delete window.tcart['currency_txt'];
	delete window.tcart['currency_txt_l'];
	delete window.tcart['currency_txt_r'];
	delete window.tcart['currency_side'];
	delete window.tcart['currency_sep'];
	delete window.tcart['currency_dec'];
	window.tcart['currency']='$';
	window.tcart['currency_side']='l';
	window.tcart['currency_sep']='.';
	window.tcart['currency_dec']='';

	if(typeof window.tcart['delivery']!='undefined'){
		delete window.tcart['delivery'];
	}
	if(typeof window.tcart['promocode']!='undefined'){
		delete window.tcart['promocode'];
	}
	
	/* if set in user payment */
	/*
	var pc=$('.t706').attr('data-userpayment-currency');
	if(typeof pc!='undefined' && pc!=''){
		window.tcart['currency']=pc;
	}
	*/
	
	/* if set inside cart block */
	var cc=$('.t706').attr('data-project-currency');
	if(typeof cc!='undefined' && cc!=''){
		window.tcart['currency']=cc;
	}
		
	/* set txt currency */
	window.tcart['currency_txt']=window.tcart['currency'];

	/* if set inside cart block */
	var cc=$('.t706').attr('data-project-currency-side');
	if(typeof cc!='undefined' && cc=='r'){
		window.tcart['currency_side']='r';
	}

	if(window.tcart['currency_side']=='l'){
		window.tcart['currency_txt_l']=window.tcart['currency_txt']+'';
		window.tcart['currency_txt_r']='';
	}else{
		window.tcart['currency_txt_r']='&nbsp;'+window.tcart['currency_txt'];
		window.tcart['currency_txt_l']='';
	}
	
	/* if set inside cart block */
	var cc=$('.t706').attr('data-project-currency-sep');
	if(typeof cc!='undefined' && (cc=='.' || cc==',')){
		window.tcart['currency_sep']=cc;
	}else{
		if(window.tcart['currency']=='$' || window.tcart['currency']=='€' || window.tcart['currency']=='USD' || window.tcart['currency']=='EUR'){
			window.tcart['currency_sep']='.';
		}else{
			window.tcart['currency_sep']=',';
		}		
	}

	/* if set inside cart block */
	var cc=$('.t706').attr('data-project-currency-dec');
	if(typeof cc!='undefined' && cc=='00'){
		window.tcart['currency_dec']=cc;
	}else{
		window.tcart['currency_dec']='';
	}
	
	/* add payment system or none */
	delete window.tcart['system'];	
	var c=$('.t706').attr('data-payment-system');
	if(typeof c!='undefined' && c!=''){
		window.tcart['system']=c;
	}else{
		window.tcart['system']='none';
	}		
	
	/* minimum order amount */
	var ma=$('.t706').attr('data-cart-minorder');
	if(typeof ma!='undefined' && ma!='' && ma>0 && typeof window.tcart_minorder=='undefined'){
		ma=ma*1
		window.tcart_minorder=ma;
		$('.t706__cartwin-prodamount-wrap').prepend('<div class="t706__cartwin-prodamount-minorder" style="opacity:0.5; font-size:14px; font-weight:400;">'+tcart__dict(11,'Minimal order')+': ' + tcart__showPrice(ma) + '</div>');
	}	
	
	/* minimum order quantity*/
	var mq=$('.t706').attr('data-cart-mincntorder');
	if(typeof mq!='undefined' && mq!='' && mq>0 && typeof window.tcart_mincntorder=='undefined'){
		mq=mq*1;
		window.tcart_mincntorder=mq;
		$('.t706__cartwin-prodamount-wrap').prepend('<div class="t706__cartwin-prodamount-mincntorder" style="opacity:0.5; font-size:14px; font-weight:400;">'+tcart__dict(12,'Minimal quantity')+': ' + mq + '</div>');
	}		
	
	/* delivery	*/
	tcart__addDelivery();
	
	/* update total */
	tcart__updateTotalProductsinCartObj();
	
	/* console.log(window.tcart); */
}

function tcart__saveLocalObj(){
	
	/* do not store */
	if(typeof window.tcart_dontstore!='undefined' && window.tcart_dontstore=='y'){
		return;
	}
	
	/* max days=0 */
	if(typeof window.tcart_maxstoredays!='undefined' && window.tcart_maxstoredays==0){
		return;
	}		
	
	if(typeof window.tcart=='object'){
		
		window.tcart.updated=Math.floor(Date.now() / 1000);
		
		var data_json_str=JSON.stringify(window.tcart);
		
		if (typeof localStorage === 'object') {
		    try {
				localStorage.setItem('tcart', data_json_str);			    
		    } catch (e) {
		        console.log('Your web browser does not support storing a Cart data locally.');
		    }
		}		
	}
}

function tcart__syncProductsObject__LStoObj(){
	/* do not store */
	if(typeof window.tcart_dontstore!='undefined' && window.tcart_dontstore=='y'){
		return;
	}
	
	/* max days=0 */
	if(typeof window.tcart_maxstoredays!='undefined' && window.tcart_maxstoredays==0){
		return;
	}		
	
	if (typeof localStorage === 'object') {
	    try {
			var foo_json_str = localStorage.getItem('tcart');
			var foo_json_obj=JSON.parse(foo_json_str);		
			if(typeof foo_json_obj['products']=='object'){
				window.tcart['products']=foo_json_obj['products'];
				tcart__updateTotalProductsinCartObj();
			}
	    } catch (e) {}
	}		
}

function tcart__addEvents(){
	$('.t706__carticon').click(function(e){
		tcart__openCart();
	});			

	$('.t706__cartwin-close').click(function(e){
		tcart__closeCart();
	});			

	$('.t706__cartwin-closebtn').click(function(e){
		tcart__closeCart();
	});		
	
	$('.t706').find('.js-form-proccess').attr('data-formcart','y');
	
	$('.t706__cartwin').click(function(e){
	    if (e.target == this) { 
		    tcart__closeCart(); 
		}  
	});
}

function tcart__addEvent__links(){
	$('[href^="#order"]').not('[data-link-event-setted]').click(function(e){
		e.preventDefault();
		
        var el = $(this);
        
        el.attr('data-link-event-setted','yes');
        
        if(typeof el.attr('data-dbclk-prevent')!='undefined' && el.attr('data-dbclk-prevent')=='yes'){
	        return;
        }else{
	        el.attr('data-dbclk-prevent','yes');
	        setTimeout(function(){el.removeAttr('data-dbclk-prevent'); }, 1000);
        }
		
		/* close other popups */
		if($("body").hasClass("t-body_popupshowed")){
		    $('body').removeClass('t-body_popupshowed');
		    $('.t-popup').removeClass('t-popup_show');
		    setTimeout(function() {
		     $('.t-popup').not('.t-popup_show').css('display', 'none');
		    }, 300);
		    tcart__clearProdUrl();
		}
		
		var tmp = el.attr('href');
		var price='0';
		var name='';
		var img='';
		var sku='';
		var lid='';
		var uid='';		
		var recid='';
		var inv='';
		
		if(tmp.substring(0, 7)=='#order:'){
			var str=tmp.substring(7);
			if(typeof str!='undefined' && str!=''){
				/* if has special parameter */
				if(str.indexOf(":::")>0){
					var bar_pos=str.indexOf(":::");
					/* duble check what this ::: not in product name */
					if(str.indexOf("=")>0 && str.indexOf("=")<str.indexOf(":::")){
						var bar_str=str.substring(bar_pos+3);
						str=str.substring(0,bar_pos);
					}
				}
				
				/* get name and price */
				if(str.indexOf("=")>0){
					var arr = str.split('=');
					if(typeof arr[0]!='undefined')name = arr[0];
					if(typeof arr[1]!='undefined')price = arr[1];
					price = tcart__cleanPrice(price);
				}else{
					name=str;
				}
				
				/* process parameters */
				if(typeof bar_str!='undefined' && bar_str!=''){
					if(bar_str.indexOf("=")>0){
						var arr = bar_str.split('=');
						if(typeof arr[0]!='undefined' && typeof arr[1]!='undefined' && arr[0]!='' && arr[1]!=''){
							if(arr[0]=='image' && arr[1].indexOf("tildacdn.com")>0){
								img=arr[1];
							}
						}
					}
				}
				
				if(recid==''){
					recid=el.closest('.r').attr('id').replace('rec', '');
					if(typeof recid=='undefined')recid='';
				}
				
			}	
		}
		
		var pel=$(this).closest('.js-product');
		if(typeof pel!='undefined'){
			if(name==''){
					name=pel.find('.js-product-name').text();
					if(typeof name=='undefined')name='';
			}
			if(price=='' || price==0){
					price = pel.find('.js-product-price').text();
					price = tcart__cleanPrice(price);
			}
			if(img==''){
				if(typeof pel.attr('data-product-img')!='undefined' && pel.attr('data-product-img')!=''){
					img=pel.attr('data-product-img');
				}else{				
					var imgdiv=pel.find('.js-product-img');
					if(typeof imgdiv!='undefined'){
						if(imgdiv.is('img')){
							img=imgdiv.attr('src');
						}
						if(imgdiv.is('div')){
							img='';
							var imgcss=imgdiv.css('background-image');
							if (typeof imgcss!='undefined' && imgcss!=''){
								img=imgcss.replace('url(','').replace(')','').replace(/\"/gi, "");
							}
						}
					}
				}
			}
			if(lid==''){
					lid=pel.attr('data-product-lid');
					if(typeof lid=='undefined')lid='';
			}
			if(uid==''){
					uid=pel.attr('data-product-uid');
					if(typeof uid=='undefined')uid='';
			}			
			if(recid==''){
					recid=pel.closest('.r').attr('id').replace('rec', '');
					if(typeof recid=='undefined')recid='';
			}			
			if(inv==''){
					inv=pel.attr('data-product-inv');
					if(typeof inv=='undefined')inv='';
			}						
			var options=[];
		    pel.find('.js-product-edition-option').each(function() {
				var el_opt=$(this);
				var op_option=el_opt.find('.js-product-edition-option-name').text();
				var op_variant=el_opt.find('option:selected').val();
				var op_price=el_opt.find('option:selected').attr('data-product-edition-variant-price');
				op_price = tcart__cleanPrice(op_price);
				
		        if(typeof op_option!='undefined' && typeof op_variant!='undefined'){
			        var obj={};
			        if(op_option!=''){
				        op_option = tcart__escapeHtml(op_option);
			        }
			        if(op_variant!=''){
				        op_variant = tcart__escapeHtml(op_variant);
				        op_variant = op_variant.replace(/(?:\r\n|\r|\n)/g, '');
			        }			        
			        if(op_option.length>1 && op_option.charAt(op_option.length-1)==':'){
				        op_option=op_option.substring(0,op_option.length-1);
			        }
					obj['option']=op_option;
					obj['variant']=op_variant;
					obj['price']=op_price;
					options.push(obj);
		        }
		    });			    			
		    pel.find('.js-product-option').each(function() {
				var el_opt=$(this);
				var op_option=el_opt.find('.js-product-option-name').text();
				var op_variant=el_opt.find('option:selected').val();
				var op_price=el_opt.find('option:selected').attr('data-product-variant-price');
				op_price = tcart__cleanPrice(op_price);
				
		        if(typeof op_option!='undefined' && typeof op_variant!='undefined'){
			        var obj={};
			        if(op_option!=''){
				        op_option = tcart__escapeHtml(op_option);
			        }
			        if(op_variant!=''){
				        op_variant = tcart__escapeHtml(op_variant);
				        op_variant = op_variant.replace(/(?:\r\n|\r|\n)/g, '');
			        }			        
			        if(op_option.length>1 && op_option.charAt(op_option.length-1)==':'){
				        op_option=op_option.substring(0,op_option.length-1);
			        }
					obj['option']=op_option;
					obj['variant']=op_variant;
					obj['price']=op_price;
					options.push(obj);
		        }
		    });	
			if(sku==''){
					sku=pel.find('.js-product-sku').text();
					if(typeof sku=='undefined')sku='';
			}					    		
		}
		
		if( name=='' && (price=='' || price==0) ){
			return;
		}
		
		if (name=='')name='NoName';
		if (price=='')price=0;
		
		if (name!='')name = tcart__escapeHtml(name);
		if (img!='')img = tcart__escapeHtmlImg(img);
		
		var productObj={};
		productObj['name']=name;
		productObj['price']=price;
		productObj['img']=img;
		
		if(typeof options!='undefined' && options.length>0){
			productObj['options']=options;
		}
		if(typeof sku!='undefined' && sku!=''){
			sku = tcart__escapeHtml(sku);
			productObj['sku']=sku;
		}
		
		if(typeof uid!='undefined' && uid!='')productObj['uid']=uid;
		if(typeof inv!='undefined' && inv>0)productObj['inv']=parseInt(inv);
		
		tcart__addProduct(productObj);

		if(typeof window.tcart_sendevent_onadd!='undefined' && window.tcart_sendevent_onadd=='y'){
			if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
				var virtPage="/tilda/cart/add/";
				if(recid>0)virtPage+=recid;
				if(lid>0)virtPage+="-"+lid;
				var virtTitle=name;
				var virtPrice=price;
				var variant_str='';
				if(typeof options!='undefined' && options.length>0){
					$.each(options, function( o_index, option ) {
						variant_str += '' + option['option'] + ': ' + option['variant'] + '; ';
					});
				}			
				var virtProduct = {
				    "ecommerce": {
				        "add": {
				            "products": [
				                {
				                    "recid": recid,
				                    "lid": lid,                    	                
				                    "sku": sku,
				                    "name": name,
				                    "price": price,
				                    "variant": variant_str,
				                    "quantity": 1
				                }
				            ]
				        }
				    }
				}			
				Tilda.sendEventToStatistics(virtPage, virtTitle, virtProduct, virtPrice);
			}
		}
		
	});	
}

function tcart__addProduct(productObj){
	var ts=Math.floor(Date.now() / 1000);
	
	/* sync products object from ls to obj */
	tcart__syncProductsObject__LStoObj();			
	
	var obj=window.tcart['products'];
	var flag_incart='';

	if(obj.length>0){
		$.each(obj, function( index, product ) {
			if(typeof window.tcart_oneproduct!='undefined' && window.tcart_oneproduct=='y'){
				
				if(product['name']==productObj['name'] && product['price']==productObj['price']){
					if( typeof product['options']=='undefined' && typeof productObj['options']=='undefined' && typeof product['sku']=='undefined' && typeof productObj['sku']=='undefined'){
						flag_incart='yes';
						return false;					
					}
					if( typeof product['options']=='undefined' && typeof productObj['options']=='undefined' && typeof product['sku']!='undefined' && typeof productObj['sku']!='undefined' && product['sku']==productObj['sku']){
						flag_incart='yes';
						return false;					
					}
				}
								
			}else{
	
				if(product['name']==productObj['name'] && product['price']==productObj['price']){

					var eq_option1='';
					var eq_option2='';
					var eq_option3='';
					var eq_sku='';										

					if(typeof product['options']=='undefined' && typeof productObj['options']=='undefined'){
						eq_option1='y';
						eq_option2='y';
						eq_option3='y';
					}else if(typeof product['options']=='object' && typeof productObj['options']=='object'){
				
							if(typeof product['options'][0]=='undefined' && typeof productObj['options'][0]=='undefined'){
								eq_option1='y';
							}else if(typeof product['options'][0]=='object' && typeof productObj['options'][0]=='object'){
								if( product['options'][0]['option']==productObj['options'][0]['option'] &&
									product['options'][0]['variant']==productObj['options'][0]['variant'] && 
									product['options'][0]['price']==productObj['options'][0]['price'] )
									{
										eq_option1='y';
									}
							}

							if(typeof product['options'][1]=='undefined' && typeof productObj['options'][1]=='undefined'){
								eq_option2='y';
							}else if(typeof product['options'][1]=='object' && typeof productObj['options'][1]=='object'){
								if( product['options'][1]['option']==productObj['options'][1]['option'] &&
									product['options'][1]['variant']==productObj['options'][1]['variant'] && 
									product['options'][1]['price']==productObj['options'][1]['price'] )
									{
										eq_option2='y';
									}
							}
							
							if(typeof product['options'][2]=='undefined' && typeof productObj['options'][2]=='undefined'){
								eq_option3='y';
							}else if(typeof product['options'][2]=='object' && typeof productObj['options'][2]=='object'){
								if( product['options'][2]['option']==productObj['options'][2]['option'] &&
									product['options'][2]['variant']==productObj['options'][2]['variant'] && 
									product['options'][2]['price']==productObj['options'][2]['price'] )
									{
										eq_option3='y';
									}
							}														
						
					}
					
					if( (typeof product['sku']=='undefined' && typeof productObj['sku']=='undefined') || product['sku']==productObj['sku']){
						eq_sku='y';
					}
						
					if(eq_option1=='y' && eq_option2=='y' && eq_option3=='y' && eq_sku=='y'){
						if(window.tcart['products'][index]['quantity']>0 && typeof productObj['inv']!='undefined' && productObj['inv']>0){
							if(window.tcart['products'][index]['quantity']==productObj['inv']){
								alert(tcart__dict(13,'Sorry, limit reached, this is the maximum quantity of goods in stock'));
								flag_incart='yes';
								return false;
							}
						}

						window.tcart['products'][index]['quantity']++;
						window.tcart['products'][index]['amount']=window.tcart['products'][index]['price']*window.tcart['products'][index]['quantity'];
						window.tcart.products[index]['amount']=tcart__roundPrice(window.tcart.products[index]['amount']);
						window.tcart['products'][index]['ts']=ts;
						flag_incart='yes';
						return false;
					}
				}
				
			}			
		});
	}
	
	if(flag_incart==''){
		productObj['amount']=productObj['price'];
		productObj['quantity']=1;
		productObj['ts']=ts;
		window.tcart['products'].push(productObj);
	}
	
	tcart__updateTotalProductsinCartObj();
		
	tcart__reDrawCartIcon();
	tcart__saveLocalObj();		
		
	if( $('.t706').attr('data-opencart-onorder')=='yes' ){
		setTimeout(function() { 
			tcart__openCart();
		}, 10);
	}else{
		$('.t706__carticon').addClass('t706__carticon_neworder');
		setTimeout(function() { 
			$('.t706__carticon').removeClass('t706__carticon_neworder');	
		}, 2000);
	}
		
	
}

function tcart__updateTotalProductsinCartObj(){
	var obj=window.tcart['products'];
	if(obj.length>0){
		
		var total=0;
		var prodamount=0;
		$.each(obj, function( index, product ) {
			total=total+product['quantity']*1;
			prodamount=prodamount*1+product['amount']*1;
		});
		prodamount = tcart__roundPrice(prodamount);
		window.tcart['total']=total;
		window.tcart['prodamount']=prodamount;
				
		var amount = prodamount;
		
		/* add pc */
		if(typeof window.tcart.promocode == 'object' && typeof window.tcart.promocode.promocode!='undefined' && window.tcart.promocode.promocode!=''){
			
			var discountsum=0;
			
			if( typeof window.tcart.promocode.discountsum!='undefined' && window.tcart.promocode.discountsum>0){
				discountsum = window.tcart.promocode.discountsum*1;
			}else if( typeof window.tcart.promocode.discountpercent!='undefined' && window.tcart.promocode.discountpercent>0){;				
				discountsum = tcart__roundPrice( amount * window.tcart.promocode.discountpercent*1/100 );
			}else{
				console.log('Cart Some error.');
			}
			
			amount = amount - discountsum;
			amount = tcart__roundPrice(amount);
			if(amount<0){amount=0;}			
				
			window.tcart['prodamount_discountsum'] = discountsum;
			window.tcart['prodamount_withdiscount'] = amount;			
			
		}
		
		/* add delivery */
		if(typeof window.tcart.delivery=='object' && typeof window.tcart.delivery.price!='undefined' && window.tcart.delivery.price>0 && window.tcart.prodamount>0){
			if(typeof window.tcart.delivery.freedl!='undefined' && window.tcart.delivery.freedl>0 && amount>=window.tcart.delivery.freedl){
				
			}else{
				amount = amount + window.tcart.delivery.price*1;	
			}
		}		
		
		if(amount>0){
			amount=tcart__roundPrice(amount);
		}
		window.tcart['amount'] = amount;
		
	}else{
		
		window.tcart['total']=0;
		window.tcart['prodamount']=0;
		window.tcart['amount']=0;
		
	}	
}

function tcart__reDrawCartIcon(){
	var tcart=window.tcart;
	var el=$('.t706__carticon');
	
	if(tcart['total']==1){
		el.css('opacity',0);	
		el.animate({opacity: 1}, 300);			
	}
		
	if(tcart['total']>0){
		el.addClass('t706__carticon_showed');
		el.find('.t706__carticon-counter').html(tcart['total']);
	}else{
		el.removeClass('t706__carticon_showed');
		el.find('.t706__carticon-counter').html('');
	}
	
	$('.t706__carticon-text').html('=&nbsp;'+tcart__showPrice(window.tcart.prodamount));
	
}

function tcart__openCart(){
	$('.t706__carticon').removeClass('t706__carticon_showed');
    $('body').addClass('t706__body_cartwinshowed');
    
	/*fix IOS11 cursor bug + general IOS background scroll*/
	setTimeout(function() {
		tcart__lockScroll();
	}, 500);
	
	/* sync products object from ls to obj */
	tcart__syncProductsObject__LStoObj();		
	
	
	var el=$('.t706__cartwin');	
	el.css('opacity',0);
	el.addClass('t706__cartwin_showed');	
	el.animate({opacity: 1}, 300);		
	tcart__reDrawProducts();
	tcart__reDrawTotal();
	$(document).keyup(tcart__keyUpFunc);
	if(window.lazy=='y'){
	    try {
			t_lazyload_update();
	    } catch (e) {
	        console.log('js lazyload not loaded');
	    }		
	}
}

function tcart__reDrawProducts(){
	var el=$('.t706__cartwin-products');	
	var obj=window.tcart['products'];
	
	var flag_hasimg='';
	if(obj.length>0){
		$.each(obj, function( index, product ) {
			if(product['img']!='')flag_hasimg='yes';
		});
	}	
	/* console.log(flag_hasimg); */
	if(obj.length>0){
		var str='';		
		$.each(obj, function( index, product ) {
			str += '<div class="t706__product" data-cart-product-i="'+index+'">';
			if(flag_hasimg=='yes')str += '<div class="t706__product-thumb"><div class="t706__product-imgdiv" style="background-image:url('+product['img']+');"></div></div>';
			str += '<div class="t706__product-title t-descr t-descr_sm">';
			str += product['name']
			if(typeof product.options!='undefined' && product.options.length>0){
				str += '<div style="opacity:0.7;font-size:12px;font-weight:400;">';
				$.each(product.options, function( o_index, option ) {
					str += '<div>' + option['option'] + ': ' + option['variant'] + '</div>';
				});
				str += '</div>';
			}
			if(typeof product['sku']!='undefined' && product['sku']!=''){
				str += '<div style="opacity:0.7;font-size:12px;font-weight:400;">';
				str += product['sku'];
				str += '</div>';
			}			
			str += '</div>';
			if(typeof window.tcart_oneproduct!='undefined' && window.tcart_oneproduct=='y'){
				str += '<div class="t706__product-plusminus t-descr t-descr_sm" style="display:none;"><span class="t706__product-quantity">'+product['quantity']+'</span></div>';
			}else{
				str += '<div class="t706__product-plusminus t-descr t-descr_sm"><span class="t706__product-minus"><img src="https://static.tildacdn.com/lib/linea/c8eecd27-9482-6c4f-7896-3eb09f6a1091/arrows_circle_minus.svg" style="width:16px;height:16px;border:0;"></span><span class="t706__product-quantity">'+product['quantity']+'</span><span class="t706__product-plus"><img src="https://static.tildacdn.com/lib/linea/c47d1e0c-6880-dc39-ae34-521197f7fba7/arrows_circle_plus.svg" style="width:16px;height:16px;border:0;"></span></div>';
			}
			str += '<div class="t706__product-amount t-descr t-descr_sm">';
			if(product['amount']>0){			
				str += tcart__showPrice(product['amount']);
			}
			str += '</div>';			
			str += '<div class="t706__product-del"><img src="https://static.tildacdn.com/lib/linea/1bec3cd7-e9d1-2879-5880-19b597ef9f1a/arrows_circle_remove.svg" style="width:20px;height:20px;border:0;"></div>';
			str += '</div>';
		});
		el.html(str);
		tcart__addEvents__forProducts();
				
	}else{
		el.html('');
	}
}

function tcart__reDrawTotal(){
	$('.t706__cartwin-prodamount').html( tcart__showPrice(window.tcart.prodamount) );	
	$('.t706__cartwin-totalamount').html( tcart__showPrice(window.tcart.amount) );

	/* add details if has delivery or promocode */
	var elinfo=$('.t706__cartwin-totalamount-info');
	elinfo.html('');
	
	if(typeof window.tcart.promocode=='object' || typeof window.tcart.delivery=='object'){
		elinfo.css('display','block');
		elinfo.append( tcart__dict(2,'Subtotal') + ': ' + tcart__showPrice(window.tcart.prodamount) + '<br>');
	}
	
	if(typeof window.tcart.promocode=='object'){		
		elinfo.append( tcart__dict(9,'Promo code') + ': ' + window.tcart.promocode.promocode + ( typeof window.tcart.promocode.discountpercent!='undefined' ? ' ' + window.tcart.promocode.discountpercent + '% ' : '') + '<br>');
		elinfo.append( tcart__dict(10,'Discount') + ': ' + tcart__showPrice(window.tcart.prodamount_discountsum) + '<br>' );
		if(window.tcart.prodamount_withdiscount>0){
			elinfo.append( tcart__dict(8,'Subtotal with discount') + ': ' + tcart__showPrice( window.tcart.prodamount_withdiscount ) + '<br>' );
		}else{
			elinfo.append( tcart__dict(8,'Subtotal with discount') + ': 0<br>' );
		}
	}

	if(typeof window.tcart.delivery=='object' && typeof window.tcart.delivery.name!='undefined' && typeof window.tcart.delivery.price!='undefined' && window.tcart.delivery.price>0){
		if(typeof window.tcart.delivery.freedl!='undefined' && window.tcart.delivery.freedl>0 && window.tcart.prodamount>=window.tcart.delivery.freedl){
			elinfo.append( window.tcart.delivery.name + ': 0 (' + tcart__dict(14,'free') + ')<br>');
		}else{
			elinfo.append( window.tcart.delivery.name + ': ' + tcart__showPrice(window.tcart.delivery.price) + '<br>');
		}
	}
	
	if(window.tcart.prodamount==0){	
		$('.t706__cartwin-prodamount-wrap').css('display','none');
	}else{
		$('.t706__cartwin-prodamount-wrap').css('display','block');
	}
	
	/* min order */
	if(typeof window.tcart_minorder!='undefined' && window.tcart_minorder>0){
		if(window.tcart.prodamount >= window.tcart_minorder ){
			$('.t706__cartwin-prodamount-minorder').css('display','none');
			$('.t706').find('.t-submit').removeClass('t706__submit_disable');
		}else{
			$('.t706__cartwin-prodamount-minorder').css('display','block');
			$('.t706').find('.t-submit').addClass('t706__submit_disable');
		}
	}

	/* min quantity order */
	if(typeof window.tcart_mincntorder!='undefined' && window.tcart_mincntorder>0){
		if(window.tcart.total >= window.tcart_mincntorder ){
			$('.t706__cartwin-prodamount-mincntorder').css('display','none');
			$('.t706').find('.t-submit').removeClass('t706__submit_disable');
		}else{
			$('.t706__cartwin-prodamount-mincntorder').css('display','block');
			$('.t706').find('.t-submit').addClass('t706__submit_disable');
		}
	}
	
	if(window.tcart.amount==0){	
		$('.t706__cartwin-totalamount-wrap').css('display','none');
	}else if(window.tcart.prodamount==window.tcart.amount){
		if($('.t706__orderform').length && $('.t706__orderform').height() > 700){
			$('.t706__cartwin-totalamount-wrap').css('display','block');
		}else{		
			$('.t706__cartwin-totalamount-wrap').css('display','none');
		}
	}else{
		$('.t706__cartwin-totalamount-wrap').css('display','block');
	}
	
	if(typeof window.tcart.promocode!='undefined'){
		$('.t706__cartwin-totalamount-wrap').css('display','block');
		if(window.tcart.amount==0){
			$('.t706__cartwin-totalamount').html('0');		
		}
	}

	if(typeof window.tcart.delivery!='undefined' && typeof window.tcart.delivery.price!='undefined' && window.tcart.delivery.price>0){
		$('.t706__cartwin-totalamount-wrap').css('display','block');
	}
				
	$('.t706__carticon-text').html('=&nbsp;'+ tcart__showPrice(window.tcart.prodamount) );
}

function tcart__addEvents__forProducts(){
	$('.t706__product-plus').click(function(e){
		tcart__product__plus($(this));
	});			

	$('.t706__product-minus').click(function(e){
		tcart__product__minus($(this));
	});			

	$('.t706__product-del').click(function(e){
		tcart__product__del($(this));
	});				
	
	$('.t706__product-quantity').click(function(e){
		tcart__product__editquantity($(this));
	});				
}

function tcart__closeCart(){
	$('body').removeClass('t706__body_cartwinshowed');
	
	/*fix IOS11 cursor bug + general IOS background scroll*/
	tcart__unlockScroll();
	
	if(typeof window.tcart_dontstore!='undefined' && window.tcart_dontstore=='y'){
		if(typeof window.tcart!='undefind'){
			if(typeof window.tcart.products!='undefind'){
				window.tcart.products=[];
			}
		}
		tcart__updateTotalProductsinCartObj();
		tcart__saveLocalObj();
		$('.t706__carticon-counter').html(window.tcart['total']);	
		tcart__reDrawTotal();
		tcart__reDrawProducts();		
	}
	
	if(window.tcart['total']>0){
		$('.t706__carticon').addClass('t706__carticon_showed');
	}
	
	tcart__delZeroquantity_inCartObj();
	
	$(document).unbind("keyup", tcart__keyUpFunc);
	
	$('.t706__carticon').removeClass('t706__carticon_neworder');	
	$('.t706__cartwin').animate({opacity: 0}, 300);
	
	setTimeout(function() { 
		$('.t706__cartwin').removeClass('t706__cartwin_showed');
		$('.t706__cartwin').css('opacity','1');
	}, 300);
	
	if(typeof window.tcart_success!='undefined' && window.tcart_success=='yes'){
		location.reload();
	}
	
}
	
function tcart__keyUpFunc(e) {
    if (e.keyCode == 27) { 
        tcart__closeCart();
    }
}	

function tcart__product__plus(thiss){
	var el=thiss.closest('.t706__product');
	var i=el.attr('data-cart-product-i');
	if(window.tcart.products[i]['quantity']>0 && typeof window.tcart.products[i]['inv']!='undefined' && window.tcart.products[i]['inv']>0){
		if(window.tcart.products[i]['inv']==window.tcart.products[i]['quantity']){
			alert(tcart__dict(13,'Sorry, limit reached, this is the maximum quantity of goods in stock'));
			return;
		}
	}
	
	window.tcart.products[i]['quantity']++;
	window.tcart.products[i]['amount']=window.tcart.products[i]['price']*window.tcart.products[i]['quantity'];
	window.tcart.products[i]['amount']=tcart__roundPrice(window.tcart.products[i]['amount']);
	el.find('.t706__product-quantity').html(window.tcart.products[i]['quantity']);
	if(window.tcart.products[i]['amount']>0){
		el.find('.t706__product-amount').html( tcart__showPrice(window.tcart.products[i]['amount']) );
	}else{
		el.find('.t706__product-amount').html('');
	}
	
	tcart__updateTotalProductsinCartObj();
	$('.t706__carticon-counter').html(window.tcart['total']);
	tcart__reDrawTotal();	
	tcart__saveLocalObj();	
}

function tcart__product__minus(thiss){
	var el=thiss.closest('.t706__product');
	var i=el.attr('data-cart-product-i');
	if(window.tcart.products[i]['quantity']>0){
		window.tcart.products[i]['quantity']--;
	}
	window.tcart.products[i]['amount']=window.tcart.products[i]['price']*window.tcart.products[i]['quantity'];
	window.tcart.products[i]['amount']=tcart__roundPrice(window.tcart.products[i]['amount']);
	el.find('.t706__product-quantity').html(window.tcart.products[i]['quantity']);
	if(window.tcart.products[i]['amount']>0){
		el.find('.t706__product-amount').html( tcart__showPrice(window.tcart.products[i]['amount']) );
	}else{
		/* tcart__product__del(thiss); */
	}
	if(window.tcart.products[i]['quantity']==0){
		tcart__product__del(thiss);
	}
	
	
	tcart__updateTotalProductsinCartObj();
	$('.t706__carticon-counter').html(window.tcart['total']);	
	tcart__reDrawTotal();
	tcart__saveLocalObj();
}

function tcart__product__del(thiss){
	var el=thiss.closest('.t706__product');
	var i=el.attr('data-cart-product-i');
	
	window.tcart.products.splice(i, 1);
	el.remove();
		
	tcart__updateTotalProductsinCartObj();
	$('.t706__carticon-counter').html(window.tcart['total']);	
	tcart__reDrawTotal();
	tcart__saveLocalObj();	
	tcart__reDrawProducts();
	if(window.tcart.products.length==0){
		tcart__closeCart();
	}

}

function tcart__product__editquantity(thiss){
	if(thiss.find('.t706__product-quantity-inp').length){
		return;
	}
	var el=thiss.closest('.t706__product');
	var i=el.attr('data-cart-product-i');
	var foo=thiss.text();
	if(foo==0 || foo>0){
		var qnt=parseInt(foo);
	}else{
		var qnt=1;
	}
	
	var str='<input type="text" name="tilda-tmp-cart-qnt" class="t706__product-quantity-inp" value="'+qnt+'" style="width:30px;">';
	thiss.html(str);
	thiss.addClass('t706__product-quantity_editing');
	
	var inp=thiss.find('.t706__product-quantity-inp');
	inp.focus(function(){
		var that = this;
		setTimeout(function(){ that.selectionStart = that.selectionEnd = 10000; }, 0);
	});
	inp.focus();

	inp.focusout(function() {
		var foo=inp.val();
		foo=parseInt(foo);
		if(foo>0){
			var qnt=foo;
		}else{
			var qnt=1;
		}
								
		tcart__product__updateQuantity(thiss,el,i,qnt);
		
		thiss.text( window.tcart.products[i]['quantity'] );
		thiss.removeClass('t706__product-quantity_editing');
	});
		
}

function tcart__product__updateQuantity(thiss,el,i,qnt){
	if(qnt>0){
		if(typeof window.tcart.products[i]['inv']!='undefined' && window.tcart.products[i]['inv']>0){
			if(qnt>window.tcart.products[i]['inv']){
				alert(tcart__dict(13,'Sorry, limit reached, this is the maximum quantity of goods in stock'));
				qnt=window.tcart.products[i]['inv'];
			}
		}
		
		window.tcart.products[i]['quantity']=qnt;
		window.tcart.products[i]['amount']=window.tcart.products[i]['price']*window.tcart.products[i]['quantity'];
		window.tcart.products[i]['amount']=tcart__roundPrice(window.tcart.products[i]['amount']);
		el.find('.t706__product-quantity').html(window.tcart.products[i]['quantity']);
		if(window.tcart.products[i]['amount']>0){
			el.find('.t706__product-amount').html( tcart__showPrice(window.tcart.products[i]['amount']) );
		}else{
			el.find('.t706__product-amount').html('');
		}		
	}else{
		tcart__product__del(thiss);
	}
	
	tcart__updateTotalProductsinCartObj();
	$('.t706__carticon-counter').html(window.tcart['total']);
	tcart__reDrawTotal();	
	tcart__saveLocalObj();
	
	if(qnt==0){
		tcart__reDrawProducts();
	}
}

function tcart__delZeroquantity_inCartObj(){
	var obj=window.tcart['products'];
	var flag_ismod='';
	if(obj.length>0){
		$.each(obj, function( index, product ) {
			if(typeof product!='undefined' && product['quantity']==0){
				window.tcart.products.splice(index,1);
				flag_ismod='yes';
			}
		});
	}		
	if(flag_ismod=='yes'){
		tcart__saveLocalObj();
	}
}

function tcart__drawBottomTotalAmount(){
	var str='';
	str += '<div class="t706__cartwin-totalamount-wrap t-descr t-descr_xl">';

	str += '<div class="t706__cartwin-totalamount-info" style="font-size:14px; padding-bottom:10px; font-weight:400;"></div>';
	
	str += '<span class="t706__cartwin-totalamount-label">Total:&nbsp;</span>';
	str += '<span class="t706__cartwin-totalamount"></span>';
	str += '</div>';
	$('.t706 .t-form__errorbox-middle').before(str);	
}

function tcart__addDelivery(){
	/* delivery */
	var wrp=$('.t706 .t-form .t-radio__wrapper-delivery');
	if(wrp.length===0)return;
		
	/* add first value if some variant checked by default */
	var ed_name=$('.t706 .t-form .t-radio__wrapper-delivery input:checked').val();
	var ed_price=$('.t706 .t-form .t-radio__wrapper-delivery input:checked').attr('data-delivery-price');
	if(typeof ed_name!='undefined' && typeof ed_price!='undefined' && ed_name!='' && ed_price!=''){
		ed_price = tcart__cleanPrice(ed_price);
		var pos = ed_name.indexOf("=");
		if(pos>0){
			ed_name = ed_name.substring(0,pos);
			ed_name = ed_name.trim();
		}
		window.tcart.delivery={};
		window.tcart.delivery['name']=ed_name;
		window.tcart.delivery['price']=ed_price;

		/* free delivery */
		var wrp=$('.t706 .t-form .t-radio__wrapper-delivery');
		if(typeof wrp.attr('data-delivery-free')!='undefined' && wrp.attr('data-delivery-free')>0){
			window.tcart.delivery['freedl']=parseInt(wrp.attr('data-delivery-free'));
		}
	}
		
	/* add event */
	var el=$('.t706 .t-form .t-radio__wrapper-delivery input');
	if(el.length){
		el.change(function() {
			var ed_name=$('.t706 .t-form .t-radio__wrapper-delivery input:checked').val();
			var ed_price=$('.t706 .t-form .t-radio__wrapper-delivery input:checked').attr('data-delivery-price');
			if(typeof ed_name!='undefined' && typeof ed_price!='undefined'){
				ed_price = tcart__cleanPrice(ed_price);
				if(ed_name!=''){
					var pos = ed_name.indexOf("=");
					if(pos>0){
						ed_name = ed_name.substring(0,pos);
						ed_name = ed_name.trim();
					}				
				}
				window.tcart.delivery={};
				window.tcart.delivery['name']=ed_name;
				window.tcart.delivery['price']=ed_price;
				
				/* free delivery */
				var wrp=$('.t706 .t-form .t-radio__wrapper-delivery');
				if(typeof wrp.attr('data-delivery-free')!='undefined' && wrp.attr('data-delivery-free')>0){
					window.tcart.delivery['freedl']=parseInt(wrp.attr('data-delivery-free'));
				}
			}else{
				if(typeof window.tcart.delivery!='undefined'){
					delete window.tcart.delivery;
				}
			}
			tcart__updateTotalProductsinCartObj();
			tcart__reDrawTotal();
		});
	}
	
}

function tcart__updateDelivery(){
	
}

function tcart__addPromocode(obj){
	/* prevent double activate promocode */
	if(typeof window.tcart.promocode=='object'){
		console.log('Error. Promocode already activated before');
		return;
	}
	
	if(typeof obj=='object' && typeof obj['promocode']!='undefined' && obj['promocode']!='' && (obj['discountsum']>0 || obj['discountpercent']>0)){
		window.tcart.promocode=obj;
	}
			
	tcart__updateTotalProductsinCartObj();	
	tcart__reDrawTotal();
}

function tcart__addEvent__selectpayment(){
	if($('.t706').find('.t-input-group_pm').length==0){
		return;
	}

	var el=$('.t706 .t-form .t-radio__wrapper-payment input');
	if(el.length){
		el.change(function() {
			var v=$('.t706 .t-form .t-radio__wrapper-payment input:checked').attr('data-payment-variant-system');
			if(typeof v!='undefined' && v!=''){
			}else{
				v='';
			}
			$('.t706').attr('data-payment-variant-system',v);
			window.tcart['system']=v;
		});
		$('.t706 .t-form .t-radio__wrapper-payment input:checked').trigger('change');
	}
		
}

function tcart__escapeHtml(text) {
  var map = {
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[<>"']/g, function(m) { return map[m]; });
}

function tcart__escapeHtmlImg(text) {
  var map = {
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;'
  };
  return text.replace(/[<>"]/g, function(m) { return map[m]; });
}

function tcart__cleanPrice(price){
	if(typeof price=='undefined' || price=='' || price==0){
		price=0;
	}else{
		price = price.replace(',','.');
		price = price.replace(/[^0-9\.]/g,'');
		price = parseFloat(price).toFixed(2);
		if(isNaN(price))price=0;		
		price = parseFloat(price);
		price = price*1;
		if(price<0)price=0;
	}
	return price;
}

function tcart__roundPrice(price){
	if(typeof price=='undefined' || price=='' || price==0){
		price=0;
	}else{
		price = parseFloat(price).toFixed(2);
		price = parseFloat(price);
		price = price*1;
		if(price<0)price=0;
	}
	return price;
}

function tcart__showPrice(price){
	if(typeof price=='undefined' || price==0 || price==''){
		price='';
	}else{
		price = price.toString();
		
		if(typeof window.tcart['currency_dec']!='undefined' && window.tcart['currency_dec']=='00'){
			if(price.indexOf('.')===-1 && price.indexOf(',')===-1){
				price=price+'.00';
			}else{
				var foo=price.substr( price.indexOf('.')+1 );
				if(foo.length===1){
					price=price+'0';
				}
			}
		}

		price = price.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');

		if(typeof window.tcart['currency_sep']!='undefined' && window.tcart['currency_sep']==','){
			price = price.replace('.',',');
		}
		price = window.tcart['currency_txt_l'] + price + window.tcart['currency_txt_r'];
		
	}
	return price;
}

function tcart__lockScroll(){
	if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {	
		var body = $("body");
		if (!body.hasClass('t-body_scroll-locked')) {
			var bodyScrollTop = (typeof window.pageYOffset !== 'undefined') ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
			body.addClass('t-body_scroll-locked');
			body.css("top","-"+bodyScrollTop+"px");
			body.attr("data-popup-scrolltop",bodyScrollTop);
		}
	}
}

function tcart__unlockScroll(){
	if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
		var body = $("body");
		if (body.hasClass('t-body_scroll-locked')) {
			var bodyScrollTop = $("body").attr("data-popup-scrolltop");
			body.removeClass('t-body_scroll-locked');
			body.css("top","");
			body.removeAttr("data-popup-scrolltop")
			window.scrollTo(0, bodyScrollTop);
		}
	}
}

function tcart__clearProdUrl() {
	try {
		var curUrl = window.location.href;
		/* check standart product url */
		indexToRemove = curUrl.indexOf('#!/tproduct/');
		if(/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove < 0) {
			indexToRemove=curUrl.indexOf('%23!/tproduct/');
			if (indexToRemove < 0) {
				indexToRemove = curUrl.indexOf('#%21%2Ftproduct%2F')
			};
		}
		/* check catalog product url */
		if (indexToRemove < 0) {
			var indexToRemove = curUrl.indexOf('/tproduct/');
			if (indexToRemove < 0) {
				indexToRemove = curUrl.indexOf('%2Ftproduct%2F')
			}
		}
		if (indexToRemove < 0) {
			return;
		}
		/* change url */
		curUrl = curUrl.substring(0, indexToRemove);
		if (typeof history.replaceState != 'undefined') {
			window.history.replaceState('', '', curUrl);
		}
	} catch (e) {

	}
}